#set( $votesWithAgreementId = $context.arguments.votesWithAgreementId )
#set( $batchData = [] )

#foreach( $voteWithAgreementId in $votesWithAgreementId )
	#set( $uuid = $util.autoId() )
    
    #set( $vote = $voteWithAgreementId.vote )
    #set( $voteDB = {
    	"PK": "Vote-$uuid",
        "SK": "Vote-$uuid",
        "result": "$vote.result"
    })
	$util.qr($batchData.add($util.dynamodb.toMapValues($voteDB)))
    
    #set( $agreementId = $voteWithAgreementId.agreementId )
    #set( $agreementDB = $voteDB )
    #set( $agreementDB.PK = $agreementId )
	$util.qr($batchData.add($util.dynamodb.toMapValues($agreementDB)))
#end


{
  "version" : "2018-05-29",
  "operation" : "BatchPutItem",
  "tables": {
    "Vysae": $utils.toJson($batchData)
  }
}
